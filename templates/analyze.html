{% extends 'base.html' %}

{% block title %}Analyzed Text - TextUtils{% endblock %}

{% block content %}

<div class="alert alert-success alert-dismissible fade show" role="alert">
    <strong>Success!</strong> Your text has been processed.
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

{% if analysis %}
<div class="alert alert-info">
    <h4 class="alert-heading">Text Analysis</h4>
    <hr>
    {% if analysis.word_count is not None %}
        <p class="mb-1"><strong>Word Count:</strong> {{ analysis.word_count }}</p>
    {% endif %}
    {% if analysis.char_count is not None %}
        <p class="mb-0"><strong>Character Count:</strong> {{ analysis.char_count }}</p>
    {% endif %}
</div>
{% endif %}
<h1>Your Processed Text - {{ purpose }}</h1>
<p>
    <pre class="alert alert-light" style="font-family: monospace; font-size: 1.1rem;">{{ analyzed_text }}</pre>
</p>

<a href="{% url 'index' %}" class="btn btn-dark">Analyze Another Text</a>
<button class="btn btn-success" id="copy-btn">Copy to Clipboard</button>

<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const copyButton = document.getElementById('copy-btn');
        // Find the <pre> tag by its new ID
        const textElement = document.getElementById('analyzed-text-pre');
        
        copyButton.addEventListener('click', () => {
            // Get the plain text content from the <pre> tag
            const textToCopy = textElement.textContent;
            
            // Use the modern navigator.clipboard API
            navigator.clipboard.writeText(textToCopy).then(() => {
                // Success! Give user feedback
                copyButton.textContent = 'Copied!';
                copyButton.classList.remove('btn-success');
                copyButton.classList.add('btn-secondary');
                
                // Reset the button text after 2 seconds
                setTimeout(() => {
                    copyButton.textContent = 'Copy to Clipboard';
                    copyButton.classList.remove('btn-secondary');
                    copyButton.classList.add('btn-success');
                }, 2000);
                
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        });
    });
</script>

{% endblock %}